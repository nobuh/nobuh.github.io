<!DOCTIYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Grayscaled Picture</title>
  <script>
    var ctx, src, img;
    
    function init() {
      var canvas = document.getElementById("field");
      ctx = canvas.getContext("2d");
      
      var pic = document.getElementById("picture");
      ctx.drawImage(pic, 0, 0, 250, 250);

	  src = ctx.getImageData(0, 0, 250, 250);
	  img = ctx.createImageData(250,250);

      processImage();
      paint();
    }

    function processImage() {
		for (var i = 0; i < 250 * 250 * 4; i+= 4) {
			var red = src.data[i + 0];
			var green = src.data[i + 1];
			var bluye = src.data[i + 2];
                        var alpha = 0xff;
                        // RGB to YUV
                        // Y = 0.299R + 0.587G + 0.114B
                        var gray = Math.floor((red * 0.299 + green * 0.587 + blue * 0.114));
			img.data[i + 0] = gray;
			img.data[i + 1] = gray; 
			img.data[i + 2] = gray; 
			img.data[i + 3] = alpha;
		}
	}

  	function paint() {
		ctx.putImageData(img, 0, 0);
	}
  </script>
</head>

<body onload="init()">
  <p>Invert the picture</p>
  <canvas id="field" width="250" height="250"></canvas>
  <p><img id="picture" src="pexels-photo-1622833.jpg" /></p>
</body>
</html>
